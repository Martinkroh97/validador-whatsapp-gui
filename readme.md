# üì± Validador de WhatsApp - C√≥digo Fuente

Aplicaci√≥n de escritorio desarrollada en Electron para validar n√∫meros de WhatsApp de forma masiva y gestionar leads de manera automatizada.

## üöÄ Caracter√≠sticas Principales

### ‚úÖ **Validaci√≥n Masiva de WhatsApp**
- Valida autom√°ticamente si los n√∫meros tienen cuenta de WhatsApp activa
- Procesa m√∫ltiples hojas de Google Sheets simult√°neamente
- Manejo inteligente de lotes para optimizar el rendimiento
- Detecci√≥n autom√°tica de n√∫meros duplicados

### üîÑ **Normalizaci√≥n Autom√°tica de Nombres**
- Elimina comillas y caracteres especiales problem√°ticos
- Corrige capitalizaci√≥n autom√°ticamente
- Normaliza espacios m√∫ltiples
- Mejora la compatibilidad con integraciones (Make, Zapier, etc.)

### üìä **Integraci√≥n con Google Sheets**
- Conexi√≥n directa con Google Sheets API
- Actualizaci√≥n en tiempo real de resultados
- Soporte para m√∫ltiples hojas de c√°lculo
- Configuraci√≥n flexible de columnas

### üéØ **Gesti√≥n de Estados**
- Marca n√∫meros v√°lidos/inv√°lidos autom√°ticamente
- Gestiona estados personalizados (procesado, enviado, etc.)
- Control de duplicados con priorizaci√≥n por fecha
- Logs detallados de todo el proceso

## üìã Requisitos de Desarrollo

### **Sistema**
- **Node.js**: v16.0.0 o superior
- **npm**: v7.0.0 o superior
- **Sistema Operativo**: Windows 10+, macOS 10.14+, o Ubuntu 18.04+
- **Memoria RAM**: M√≠nimo 4GB, recomendado 8GB
- **Conexi√≥n a internet**: Requerida para WhatsApp Web y Google Sheets

### **Navegadores soportados**
- Google Chrome
- Microsoft Edge
- Brave Browser
- Chromium

## üõ† Instalaci√≥n y Configuraci√≥n

### 1. **Clonar el repositorio**
```bash
git clone https://github.com/tu-usuario/validador-whatsapp.git
cd validador-whatsapp
```

### 2. **Instalar dependencias**
```bash
npm install
```

### 3. **Configurar Google Sheets API**
1. Ve a [Google Cloud Console](https://console.cloud.google.com/)
2. Crea un nuevo proyecto o selecciona uno existente
3. Habilita la **Google Sheets API**
4. Ve a **Credenciales** ‚Üí **Crear credenciales** ‚Üí **Cuenta de servicio**
5. Completa los datos y descarga el archivo JSON
6. Ren√≥mbralo a `credenciales.json`
7. Col√≥calo en la carpeta que la app te indique al ejecutarse

### 4. **Ejecutar en modo desarrollo**
```bash
npm run dev
```

### 5. **Compilar para producci√≥n**
```bash
# Para tu plataforma actual
npm run build

# Para plataformas espec√≠ficas
npm run build:win    # Windows
npm run build:mac    # macOS
npm run build:linux  # Linux
```

## üìÅ Estructura del Proyecto

```
validador-whatsapp/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.js              # Proceso principal de Electron
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ preload.js           # Script de preload
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validator.js         # L√≥gica de validaci√≥n de WhatsApp
‚îÇ   ‚îî‚îÄ‚îÄ renderer/
‚îÇ       ‚îú‚îÄ‚îÄ index.html           # Interfaz principal
‚îÇ       ‚îú‚îÄ‚îÄ renderer.js          # L√≥gica del frontend
‚îÇ       ‚îî‚îÄ‚îÄ styles.css           # Estilos de la aplicaci√≥n
‚îú‚îÄ‚îÄ configs/                     # Archivos de configuraci√≥n JSON
‚îú‚îÄ‚îÄ package.json                 # Dependencias y scripts
‚îú‚îÄ‚îÄ electron-builder.yml        # Configuraci√≥n de compilaci√≥n
‚îî‚îÄ‚îÄ README.md                   # Este archivo
```

## üîß Scripts Disponibles

```bash
# Desarrollo
npm run dev              # Ejecutar en modo desarrollo
npm run start           # Iniciar aplicaci√≥n compilada

# Compilaci√≥n
npm run build           # Compilar para la plataforma actual
npm run build:win       # Compilar para Windows
npm run build:mac       # Compilar para macOS
npm run build:linux     # Compilar para Linux
npm run build:all       # Compilar para todas las plataformas

# Utilidades
npm run clean           # Limpiar archivos temporales
npm run lint            # Verificar c√≥digo con ESLint
npm run test            # Ejecutar tests (si est√°n configurados)
```

## ‚öôÔ∏è Configuraci√≥n de Desarrollo

### **Variables de Entorno**
Crea un archivo `.env` en la ra√≠z del proyecto:

```env
NODE_ENV=development
DEBUG=true
GOOGLE_SHEETS_SCOPES=https://www.googleapis.com/auth/spreadsheets
BATCH_SIZE=5
DELAY_BETWEEN_REQUESTS=1500
```

### **Configuraci√≥n de Google Sheets**
Tu hoja de c√°lculo debe tener estas columnas (nombres configurables):

| Columna | Descripci√≥n | Requerida |
|---------|-------------|-----------|
| **WhatsApp** | N√∫meros de tel√©fono | ‚úÖ |
| **Validaci√≥n WA** | Resultado de validaci√≥n | ‚úÖ |
| **Estado** | Estado del lead | ‚ùå |
| **Nombre** | Nombre del lead | ‚ùå |
| **WhatsApp** | WhastApp (para detecci√≥n de duplicados) | ‚ùå |

### **Archivo de Configuraci√≥n**
Crea archivos JSON en la carpeta `configs/`:

```json
{
  "nombre": "Mi Empresa - Validaci√≥n",
  "descripcion": "Validaci√≥n de leads para campa√±a 2024",
  "principales": [
    {
      "spreadsheetId": "1ABC123-ID-DE-GOOGLE-SHEETS-XYZ",
      "sheetName": "Leads Enero",
      "range": "A1:Z",
      "columnas": {
        "whatsapp": "WhatsApp",
        "validacion": "Validaci√≥n WA",
        "estado": "Estado",
        "nombre": "Nombre"
      }
    }
  ]
}
```

## üèó Arquitectura del C√≥digo

### **Proceso Principal (main.js)**
```javascript
// Maneja:
- Creaci√≥n de ventanas de Electron
- Comunicaci√≥n IPC con el renderer
- Gesti√≥n de archivos de configuraci√≥n
- Validaci√≥n de credenciales
```

### **Core de Validaci√≥n (validator.js)**
```javascript
// Clase principal que maneja:
- Conexi√≥n con WhatsApp Web via puppeteer
- Validaci√≥n masiva de n√∫meros
- Normalizaci√≥n autom√°tica de nombres
- Detecci√≥n de n√∫meros duplicados
- Actualizaci√≥n de Google Sheets
```

### **Interfaz de Usuario (renderer.js)**
```javascript
// Controla:
- Interfaz gr√°fica y UX
- Creaci√≥n visual de configuraciones
- Monitoreo en tiempo real
- Sistema de logs y notificaciones
```

## üîÑ Flujo de Validaci√≥n

1. **Inicializaci√≥n**
   ```javascript
   // validator.js - Constructor
   new ValidadorCore(configPath, baseDir, userDataPath)
   ```

2. **Conexi√≥n WhatsApp**
   ```javascript
   // Inicializar cliente WhatsApp Web
   await this.initializeWhatsApp()
   ```

3. **Procesamiento**
   ```javascript
   // Escanear ‚Üí Duplicados ‚Üí Validar ‚Üí Normalizar
   await this.startValidationProcess()
   ```

4. **Normalizaci√≥n de Nombres**
   ```javascript
   // Funci√≥n integrada en validarNumerosWhatsApp()
   const normalizedName = this.normalizeLeadName(originalName)
   ```

## üß™ Testing y Debug

### **Modo Debug**
```bash
# Ejecutar con logs detallados
DEBUG=* npm run dev

# O establecer en el c√≥digo
process.env.DEBUG = 'true'
```

### **Logs del Sistema**
Los logs se guardan en:
- **Windows**: `%APPDATA%/Validador WhatsApp/`
- **macOS**: `~/Library/Application Support/Validador WhatsApp/`
- **Linux**: `~/.config/Validador WhatsApp/`

### **Testing Manual**
1. Crea una hoja de Google Sheets de prueba
2. Agrega algunos n√∫meros de prueba
3. Configura una configuraci√≥n de test
4. Ejecuta validaci√≥n con lote peque√±o

## üîß Personalizaci√≥n y Extensions

### **Agregar Nuevas Funcionalidades**

1. **Nueva columna personalizada**:
```javascript
// En validator.js - funci√≥n validarNumerosWhatsApp
const nuevaColName = columnas.nuevaColumna;
const nuevaIndex = headers.findIndex(h => h === nuevaColName);
```

2. **Modificar normalizaci√≥n**:
```javascript
// En validator.js - funci√≥n normalizeLeadName
// Agregar nuevas reglas de limpieza
normalized = normalized.replace(/patr√≥n/g, 'reemplazo');
```

3. **Nueva validaci√≥n**:
```javascript
// Crear nueva funci√≥n en validator.js
async nuevaValidacion(config) {
  // Tu l√≥gica aqu√≠
}
```

### **Modificar la Interfaz**

1. **Estilos CSS**:
```css
/* En styles.css */
.nueva-clase {
  /* Tus estilos */
}
```

2. **Nuevos componentes**:
```javascript
// En renderer.js
function nuevoComponente() {
  // Tu l√≥gica de UI
}
```

## üì¶ Dependencias Principales

```json
{
  "electron": "^28.0.0",
  "whatsapp-web.js": "^1.23.0",
  "googleapis": "^128.0.0",
  "puppeteer": "^21.0.0"
}
```

### **Dependencias de Desarrollo**
```json
{
  "electron-builder": "^24.6.0",
  "nodemon": "^3.0.0",
  "eslint": "^8.0.0"
}
```

## üõ† Troubleshooting de Desarrollo

### **Problemas Comunes**

#### **Error de instalaci√≥n de Puppeteer**
```bash
# Reinstalar puppeteer
npm install puppeteer --force

# O usar variable de entorno
PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true npm install
```

#### **Problemas con Electron**
```bash
# Limpiar cache de Electron
npm run clean
rm -rf node_modules
npm install
```

#### **Error de permisos en macOS**
```bash
# Dar permisos a la app
sudo xattr -rd com.apple.quarantine dist/mac/Validador.app
```

#### **Debug de WhatsApp Web**
```javascript
// En validator.js - cambiar headless a false
puppeteer: {
  headless: false,  // Ver el navegador
  devtools: true    // Abrir DevTools
}
```

## üîí Consideraciones de Seguridad

### **Credenciales**
- ‚úÖ Nunca commites `credenciales.json`
- ‚úÖ Usa variables de entorno para datos sensibles
- ‚úÖ Las credenciales se procesan localmente

### **WhatsApp**
- ‚úÖ Usa WhatsApp Web oficial
- ‚úÖ No almacena datos de WhatsApp
- ‚úÖ Respeta t√©rminos de servicio de WhatsApp

### **Google Sheets**
- ‚úÖ Conexi√≥n encriptada (HTTPS)
- ‚úÖ Permisos m√≠nimos necesarios
- ‚úÖ No almacena datos de hojas localmente

## ü§ù Contribuci√≥n

### **Setup para Contribuir**
1. Fork el repositorio
2. Crea una rama: `git checkout -b feature/nueva-funcionalidad`
3. Instala dependencias: `npm install`
4. Haz tus cambios
5. Ejecuta tests: `npm run lint`
6. Commit: `git commit -am 'Agregar nueva funcionalidad'`
7. Push: `git push origin feature/nueva-funcionalidad`
8. Abre un Pull Request

### **Gu√≠as de Contribuci√≥n**
- Usa **ESLint** para mantener consistencia en el c√≥digo
- Comenta funciones complejas
- Actualiza el README si agregas nuevas features
- Prueba en m√∫ltiples plataformas si es posible

### **Estructura de Commits**
```
tipo(scope): descripci√≥n corta

Descripci√≥n m√°s detallada si es necesario

- Cambio 1
- Cambio 2
```

Tipos: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`

## üìÑ Licencia

Este proyecto es de libre uso.

## üí¨ Soporte para Desarrolladores

### **Canales de Comunicaci√≥n**
- üêõ **Issues**: [GitHub Issues](../../issues)
- üí¨ **Discusiones**: [GitHub Discussions](../../discussions)
- üìñ **Wiki**: [Documentaci√≥n t√©cnica](../../wiki)
- üìß **Email**: [mkroh81@gmail.com](mailto:mkroh81@gmail.com)

### **Recursos √ötiles**
- [Electron Documentation](https://electronjs.org/docs)
- [WhatsApp Web.js Guide](https://wwebjs.dev/)
- [Google Sheets API](https://developers.google.com/sheets/api)
- [Puppeteer Documentation](https://pptr.dev/)

---

## üöÄ Quick Start para Desarrolladores

```bash
# Clonar e instalar
git clone https://github.com/tu-usuario/validador-whatsapp.git
cd validador-whatsapp
npm install

# Configurar credenciales (ver secci√≥n de configuraci√≥n)
# Colocar credenciales.json en la carpeta indicada

# Ejecutar en desarrollo
npm run dev

# Para producci√≥n
npm run build
```

---

**‚≠ê Si contribuyes al proyecto, no olvides darle una estrella en GitHub**

---

Desarrollado con Electron y Node.js